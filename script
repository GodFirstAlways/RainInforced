--[[
    RainInforced - Main Script
    Loads UI and handles core logic
]]

-- Check if already loaded
if game.CoreGui:FindFirstChild("SysBroker") then
    game:GetService("StarterGui"):SetCore("SendNotification", {
        Title = "RainInforced",
        Text = "GUI Already loaded, rejoin to re-execute",
        Duration = 5
    })
    return
end

-- Version
local version = 2

-- Services
local Players = game:GetService("Players")
local plr = Players.LocalPlayer
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")
local Light = game:GetService("Lighting")
local HttpService = game:GetService("HttpService")
local httprequest = (syn and syn.request) or (http and http.request) or http_request or (fluxus and fluxus.request) or request
local mouse = plr:GetMouse()

-- Global Variables
_G.AntiFlingToggled = false
local ScriptWhitelist = {}
local ForceWhitelist = {}
local TargetedPlayer = nil
local FlySpeed = 50
local PotionTool = nil
local SavedCheckpoint = nil
local MinesFolder = nil
local FreeEmotesEnabled = false
local CannonsFolders = {}

-- Initialize game-specific elements
pcall(function()
    MinesFolder = game:GetService("Workspace").Landmines
    for i,v in pairs(game:GetService("Workspace"):GetChildren()) do
        if v.Name == "Cannons" then
            table.insert(CannonsFolders, v)
        end
    end
end)

-- Shield function
_G.shield = function(id)
    if not table.find(ForceWhitelist, id) then
        table.insert(ForceWhitelist, id)
    end
end

-- Load Functions Module
local Functions = loadstring(game:HttpGet("https://raw.githubusercontent.com/GodFirstAlways/RainInforced/main/functions"))()

-- Apply functions to global scope
local RandomChar = Functions.RandomChar
local ChangeToggleColor = Functions.ChangeToggleColor
local GetPing = Functions.GetPing
local GetPlayer = Functions.GetPlayer
local GetCharacter = Functions.GetCharacter
local GetRoot = Functions.GetRoot
local TeleportTO = Functions.TeleportTO
local PredictionTP = Functions.PredictionTP
local Touch = Functions.Touch
local GetPush = Functions.GetPush
local CheckPotion = Functions.CheckPotion
local Push = Functions.Push
local ToggleRagdoll = Functions.ToggleRagdoll
local ToggleVoidProtection = Functions.ToggleVoidProtection
local PlayAnim = Functions.PlayAnim
local StopAnim = Functions.StopAnim
local SendNotify = Functions.SendNotify

-- Load UI Module
local UI = loadstring(game:HttpGet("https://raw.githubusercontent.com/GodFirstAlways/RainInforced/main/ui"))()

-- Get UI elements
local SysBroker = UI.SysBroker
local Background = UI.Background
local AllButtons = UI.Buttons
local AllSections = UI.Sections
local AllInputs = UI.Inputs

-- Section change function
local function ChangeSection(SectionClicked)
    local SectionClickedName = string.split(SectionClicked.Name, "_")[1]
    for i,v in pairs(AllSections.SectionList:GetChildren()) do
        if v:IsA("TextButton") then
            v.Transparency = (v.Name == SectionClicked.Name) and 0 or 0.5
        end
    end
    for i,v in pairs(Background:GetChildren()) do
        if v:IsA("ScrollingFrame") then
            local SectionForName = string.split(v.Name, "_")[1]
            v.Visible = string.find(SectionClickedName, SectionForName) ~= nil
        end
    end
end

-- Initialize home section
ChangeSection(AllButtons.Home_Section_Button)

-- Setup section buttons
AllButtons.Home_Section_Button.MouseButton1Click:Connect(function()
    ChangeSection(AllButtons.Home_Section_Button)
end)

AllButtons.Game_Section_Button.MouseButton1Click:Connect(function()
    ChangeSection(AllButtons.Game_Section_Button)
end)

AllButtons.Character_Section_Button.MouseButton1Click:Connect(function()
    ChangeSection(AllButtons.Character_Section_Button)
end)

AllButtons.Target_Section_Button.MouseButton1Click:Connect(function()
    ChangeSection(AllButtons.Target_Section_Button)
end)

AllButtons.Animations_Section_Button.MouseButton1Click:Connect(function()
    ChangeSection(AllButtons.Animations_Section_Button)
end)

AllButtons.Misc_Section_Button.MouseButton1Click:Connect(function()
    ChangeSection(AllButtons.Misc_Section_Button)
end)

AllButtons.Credits_Section_Button.MouseButton1Click:Connect(function()
    ChangeSection(AllButtons.Credits_Section_Button)
end)

-- GAME SECTION FUNCTIONS
local AntiRagdollFunction = nil
AllButtons.AntiRagdoll_Button.MouseButton1Click:Connect(function()
    ChangeToggleColor(AllButtons.AntiRagdoll_Button)
    ToggleRagdoll(true)
    if AllButtons.AntiRagdoll_Button.Ticket_Asset.ImageColor3 == Color3.fromRGB(0,255,0) then
        AntiRagdollFunction = GetRoot(plr).ChildAdded:Connect(function(Force)
            if Force.Name == "PushForce" then
                Force.MaxForce = Vector3.new(0,0,0)
                Force.Velocity = Vector3.new(0,0,0)
            end
        end)
    else
        ToggleRagdoll(false)
        AntiRagdollFunction:Disconnect()
    end
end)

-- Add more button connections here...
-- (Copy all your existing button logic from the original script)

-- Open/Close GUI
AllButtons.OpenClose.MouseButton1Click:Connect(function()
    Background.Visible = not Background.Visible
end)

game:GetService("UserInputService").InputBegan:Connect(function(input, gameProcessedEvent)
    if gameProcessedEvent then return end
    if input.KeyCode == Enum.KeyCode.B then
        Background.Visible = not Background.Visible
    end
end)

-- Version checker
task.spawn(function()
    while task.wait(10) do
        pcall(function()
            local GuiVersion = loadstring(game:HttpGet("https://raw.githubusercontent.com/GodFirstAlways/RainInforced/main/version"))()
            if version < GuiVersion then
                SendNotify("RainInforced", "You are not using the latest version, run the script again.", 5)
                task.wait(5)
                SysBroker:Destroy()
                game:GetService("TeleportService"):TeleportToPlaceInstance(game.PlaceId, game.JobId, plr)
            end
        end)
    end
end)

-- Welcome message
SendNotify("RainInforced", "Gui modified by GodFirstAlways - Discord in your clipboard JOIN IT", 10)
setclipboard("https://discord.gg/aCS8sjBVbn")
loadstring(game:HttpGet("https://raw.githubusercontent.com/GodFirstAlways/RainInforced/main/premium"))()